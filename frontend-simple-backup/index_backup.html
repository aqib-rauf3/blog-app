<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Blog with Database v3.0</title> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"> 
    <style> 
        * { margin: 0; padding: 0; box-sizing: border-box; } 
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; } 
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; } 
        header { text-align: center; background: white; padding: 40px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); } 
        h1 { color: #2563eb; font-size: 2.5em; margin-bottom: 10px; } 
        .tagline { color: #64748b; font-size: 1.2em; margin-bottom: 20px; } 
        .auth-section { background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); } 
        .auth-buttons { display: flex; gap: 10px; margin-bottom: 20px; } 
        .btn { padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s; } 
        .btn-primary { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; } 
        .btn-secondary { background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); color: white; } 
        .btn-danger { background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%); color: white; } 
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.2); } 
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; } 
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); } 
        .card h2 { color: #374151; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; } 
        .form-group { margin-bottom: 15px; } 
        .form-group label { display: block; margin-bottom: 5px; color: #4a5568; } 
        .form-control { width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 16px; } 
        .form-control:focus { outline: none; border-color: #4299e1; } 
        .status { padding: 15px; border-radius: 8px; margin-top: 15px; background: #f7fafc; border-left: 4px solid #cbd5e0; } 
        .healthy { color: #48bb78; } 
        .error { color: #f56565; } 
        .posts-container { background: white; padding: 25px; border-radius: 15px; margin-top: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); } 
        .post { padding: 20px; border-bottom: 1px solid #e2e8f0; transition: all 0.3s; } 
        .post:hover { background: #f7fafc; transform: translateX(5px); } 
        .post h3 { color: #2d3748; margin-bottom: 8px; font-size: 1.3em; } 
        .post p { color: #718096; line-height: 1.6; margin-bottom: 10px; } 
        .post-meta { display: flex; justify-content: space-between; color: #a0aec0; font-size: 0.9em; } 
        .service-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; } 
        .service { text-align: center; padding: 15px; background: #f8fafc; border-radius: 10px; border: 2px solid #e2e8f0; transition: all 0.3s; } 
        .service:hover { border-color: #667eea; transform: translateY(-5px); } 
        .service i { font-size: 2em; color: #667eea; margin-bottom: 10px; } 
        .user-info { background: linear-gradient(135deg, #d6bcfa 0%, #9f7aea 100%); color: white; padding: 15px; border-radius: 10px; margin-top: 10px; } 
        footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e2e8f0; color: #718096; } 
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; } 
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } 
        .hidden { display: none; } 
    </style> 
</head> 
<body> 
    <div class="container"> 
        <header> 
            <h1><i class="fas fa-blog"></i> Blog with Database v3.0</h1> 
            <p class="tagline">Week 3: JWT Authentication + Create Posts + Enhanced UI</p> 
            <div id="user-info" class="hidden"></div> 
        </header> 
 
        <div class="auth-section"> 
            <h2><i class="fas fa-user"></i> Authentication</h2> 
            <div class="auth-buttons"> 
                <button class="btn btn-primary" onclick="showLoginForm()"><i class="fas fa-sign-in-alt"></i> Login</button> 
                <button class="btn btn-secondary" onclick="showRegisterForm()"><i class="fas fa-user-plus"></i> Register</button> 
                <button class="btn btn-danger" onclick="logout()" id="logout-btn" class="hidden"><i class="fas fa-sign-out-alt"></i> Logout</button> 
            </div> 
 
            <div id="login-form" class="hidden"> 
                <div class="form-group"> 
                    <label>Username or Email</label> 
                    <input type="text" id="login-username" class="form-control" placeholder="Enter username or email"> 
                </div> 
                <div class="form-group"> 
                    <label>Password</label> 
                    <input type="password" id="login-password" class="form-control" placeholder="Enter password"> 
                </div> 
                <button class="btn btn-primary" onclick="login()"><i class="fas fa-sign-in-alt"></i> Login</button> 
                <button class="btn" onclick="hideForms()">Cancel</button> 
            </div> 
 
            <div id="register-form" class="hidden"> 
                <div class="form-group"> 
                    <label>Username</label> 
                    <input type="text" id="register-username" class="form-control" placeholder="Choose a username"> 
                </div> 
                <div class="form-group"> 
                    <label>Email</label> 
                    <input type="email" id="register-email" class="form-control" placeholder="Enter your email"> 
                </div> 
                <div class="form-group"> 
                    <label>Password</label> 
                    <input type="password" id="register-password" class="form-control" placeholder="At least 6 characters"> 
                </div> 
                <button class="btn btn-secondary" onclick="register()"><i class="fas fa-user-plus"></i> Register</button> 
                <button class="btn" onclick="hideForms()">Cancel</button> 
            </div> 
 
            <div id="create-post-form" class="hidden"> 
                <h3><i class="fas fa-edit"></i> Create New Post</h3> 
                <div class="form-group"> 
                    <label>Title</label> 
                    <input type="text" id="post-title" class="form-control" placeholder="Enter post title"> 
                </div> 
                <div class="form-group"> 
                    <label>Content</label> 
                    <textarea id="post-content" class="form-control" rows="4" placeholder="Write your post content..."></textarea> 
                </div> 
                <button class="btn btn-primary" onclick="createPost()"><i class="fas fa-paper-plane"></i> Publish Post</button> 
                <button class="btn" onclick="hidePostForm()">Cancel</button> 
            </div> 
        </div> 
 
        <div class="dashboard"> 
            <div class="card"> 
                <h2><i class="fas fa-heartbeat"></i> System Health</h2> 
                <button class="btn btn-primary" onclick="checkHealth()"><i class="fas fa-stethoscope"></i> Check Health</button> 
                <button class="btn btn-secondary" onclick="getPosts()"><i class="fas fa-sync-alt"></i> Refresh Posts</button> 
                <button class="btn" onclick="showPostForm()" id="create-post-btn" class="hidden"><i class="fas fa-plus"></i> Create Post</button> 
                <div id="health-status" class="status">Click buttons to check system</div> 
            </div> 
 
            <div class="card"> 
                <h2><i class="fas fa-database"></i> Database Info</h2> 
                <button class="btn" onclick="getDbInfo()"><i class="fas fa-info-circle"></i> Get DB Info</button> 
                <button class="btn btn-danger" onclick="clearCache()" id="clear-cache-btn" class="hidden"><i class="fas fa-trash"></i> Clear Cache</button> 
                <div id="db-info" class="status">Database info will appear here</div> 
            </div> 
 
            <div class="card"> 
                <h2><i class="fas fa-server"></i> Services</h2> 
                <div class="service-grid"> 
                    <div class="service"><i class="fas fa-code"></i><p>Flask API</p><p>Port 5001</p><div id="api-status">?</div></div> 
                    <div class="service"><i class="fas fa-database"></i><p>PostgreSQL</p><p>Port 5432</p><div id="db-status">?</div></div> 
                    <div class="service"><i class="fas fa-bolt"></i><p>Redis</p><p>Port 6379</p><div id="redis-status">?</div></div> 
                    <div class="service"><i class="fas fa-globe"></i><p>Frontend</p><p>Port 8081</p><div id="frontend-status">?</div></div> 
                </div> 
            </div> 
        </div> 
 
        <div class="posts-container"> 
            <h2><i class="fas fa-newspaper"></i> Blog Posts <span id="posts-count"></span></h2> 
            <div id="posts-list">Loading posts... <div class="loading"></div></div> 
        </div> 
 
        <footer> 
        </footer> 
    </div> 
 
    <script> 
        const API_URL = 'http://localhost:5001/api'; 
 
        // Initialize on page load 
        document.addEventListener('DOMContentLoaded', function() { 
            updateAuthUI(); 
            checkHealth(); 
            getPosts(); 
        }); 
 
        // Authentication functions 
        function updateAuthUI() { 
            const userInfo = document.getElementById('user-info'); 
            const logoutBtn = document.getElementById('logout-btn'); 
            const createPostBtn = document.getElementById('create-post-btn'); 
            const clearCacheBtn = document.getElementById('clear-cache-btn'); 
 
                userInfo.className = 'user-info'; 
                userInfo.innerHTML = `<strong>?? Welcome, ${currentUser.username}!</strong>`; 
                logoutBtn.classList.remove('hidden'); 
                createPostBtn.classList.remove('hidden'); 
                clearCacheBtn.classList.remove('hidden'); 
            } else { 
                userInfo.className = 'hidden'; 
                logoutBtn.classList.add('hidden'); 
                createPostBtn.classList.add('hidden'); 
                clearCacheBtn.classList.add('hidden'); 
            } 
        } 
 
        function showLoginForm() { 
            hideForms(); 
            document.getElementById('login-form').classList.remove('hidden'); 
        } 
 
        function showRegisterForm() { 
            hideForms(); 
            document.getElementById('register-form').classList.remove('hidden'); 
        } 
 
        function showPostForm() { 
            hideForms(); 
            document.getElementById('create-post-form').classList.remove('hidden'); 
        } 
 
        function hideForms() { 
            document.getElementById('login-form').classList.add('hidden'); 
            document.getElementById('register-form').classList.add('hidden'); 
            document.getElementById('create-post-form').classList.add('hidden'); 
        } 
 
        function hidePostForm() { 
            document.getElementById('create-post-form').classList.add('hidden'); 
            document.getElementById('post-title').value = ''; 
            document.getElementById('post-content').value = ''; 
        } 
 
        async function login() { 
            const username = document.getElementById('login-username').value; 
            const password = document.getElementById('login-password').value; 
 
                alert('Please enter username and password'); 
                return; 
            } 
 
            try { 
                const response = await fetch(API_URL + '/auth/login', { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ username, password }) 
                }); 
 
                const data = await response.json(); 
 
                if (response.ok) { 
                    currentToken = data.token; 
                    currentUser = data.user; 
                    localStorage.setItem('blog_token', currentToken); 
                    localStorage.setItem('blog_user', JSON.stringify(currentUser)); 
                    updateAuthUI(); 
                    hideForms(); 
                    alert('Login successful!'); 
                    getPosts(); // Refresh posts to show authenticated features 
                } else { 
                    alert('Login failed: ' + data.error); 
                } 
            } catch (error) { 
                alert('Error: ' + error.message); 
            } 
        } 
 
        async function register() { 
            const username = document.getElementById('register-username').value; 
            const email = document.getElementById('register-email').value; 
            const password = document.getElementById('register-password').value; 
 
                alert('Please fill all fields'); 
                return; 
            } 
 
                alert('Password must be at least 6 characters'); 
                return; 
            } 
 
            try { 
                const response = await fetch(API_URL + '/auth/register', { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ username, email, password }) 
                }); 
 
                const data = await response.json(); 
 
                if (response.status === 201) { 
                    currentToken = data.token; 
                    currentUser = data.user; 
                    localStorage.setItem('blog_token', currentToken); 
                    localStorage.setItem('blog_user', JSON.stringify(currentUser)); 
                    updateAuthUI(); 
                    hideForms(); 
                    alert('Registration successful!'); 
                    getPosts(); 
                } else { 
                    alert('Registration failed: ' + data.error); 
                } 
            } catch (error) { 
                alert('Error: ' + error.message); 
            } 
        } 
 
        function logout() { 
            currentToken = null; 
            currentUser = null; 
            localStorage.removeItem('blog_token'); 
            localStorage.removeItem('blog_user'); 
            updateAuthUI(); 
            alert('Logged out successfully'); 
            getPosts(); 
        } 
 
        async function createPost() { 
            if (!currentToken) { 
                alert('Please login to create a post'); 
                return; 
            } 
 
            const title = document.getElementById('post-title').value; 
            const content = document.getElementById('post-content').value; 
 
                alert('Please enter title and content'); 
                return; 
            } 
 
            try { 
                const response = await fetch(API_URL + '/posts', { 
                    method: 'POST', 
                    headers: { 
                        'Content-Type': 'application/json', 
                        'Authorization': 'Bearer ' + currentToken 
                    }, 
                    body: JSON.stringify({ title, content }) 
                }); 
 
                const data = await response.json(); 
 
                if (response.status === 201) { 
                    hidePostForm(); 
                    alert('Post created successfully!'); 
                    getPosts(); 
                } else { 
                } 
            } catch (error) { 
                alert('Error: ' + error.message); 
            } 
        } 
 
        // System functions 
        async function checkHealth() { 
            const statusDiv = document.getElementById('health-status'); 
            statusDiv.innerHTML = '<div class="loading"></div> Checking...'; 
 
            try { 
                const response = await fetch(API_URL + '/health'); 
                const data = await response.json(); 
 
                statusDiv.innerHTML = ` 
                    <strong>System Status: <span class="healthy">? ${data.status}</span></strong><br> 
                    Version: ${data.version}<br> 
                    Database: <span class="${data.database === 'connected' ? 'healthy' : 'error'}">${data.database}</span><br> 
                    Redis: <span class="${data.redis === 'connected' ? 'healthy' : 'error'}">${data.redis}</span><br> 
                    Time: ${new Date(data.timestamp).toLocaleTimeString()} 
                `; 
 
                // Update service status indicators 
                document.getElementById('api-status').innerHTML = data.status === 'healthy' ? '?' : '?'; 
                document.getElementById('db-status').innerHTML = data.database === 'connected' ? '?' : '?'; 
                document.getElementById('redis-status').innerHTML = data.redis === 'connected' ? '?' : '?'; 
 
            } catch (error) { 
                statusDiv.innerHTML = `<strong class="error">? Error:</strong> ${error.message}`; 
                document.getElementById('api-status').innerHTML = '?'; 
            } 
        } 
 
        async function getPosts() { 
            const postsDiv = document.getElementById('posts-list'); 
            postsDiv.innerHTML = '<div class="loading"></div> Loading posts...'; 
 
            try { 
                const response = await fetch(API_URL + '/posts'); 
                const data = await response.json(); 
 
                    const postsCount = document.getElementById('posts-count'); 
                    postsCount.innerHTML = `(${data.posts.length})`; 
 
                    postsDiv.innerHTML = ` 
                        <p style="color: #718096; margin-bottom: 15px;">Source: <strong>${data.source}</strong></p> 
                        ${data.posts.map(post =
                            <div class="post"> 
                                <h3>${post.title}</h3> 
                                <p>${post.content}</p> 
                                <div class="post-meta"> 
                                    <span>${new Date(post.created_at).toLocaleDateString()}</span> 
                                </div> 
                            </div> 
                        `).join('')} 
                    `; 
                } else { 
                    postsDiv.innerHTML = 'No posts found.'; 
                } 
            } catch (error) { 
                postsDiv.innerHTML = `<p class="error">Error loading posts: ${error.message}</p>`; 
            } 
        } 
 
        async function getDbInfo() { 
            const dbDiv = document.getElementById('db-info'); 
            dbDiv.innerHTML = '<div class="loading"></div> Loading database info...'; 
 
            try { 
                const response = await fetch(API_URL + '/db-info'); 
                const data = await response.json(); 
 
                dbDiv.innerHTML = ` 
                    <strong>Database: ${data.database}</strong><br> 
                    Tables: ${data.tables.join(', ')}<br> 
                    Total Posts: ${data.post_count}<br> 
                `; 
            } catch (error) { 
                dbDiv.innerHTML = `<span class="error">Error: ${error.message}</span>`; 
            } 
        } 
 
        async function clearCache() { 
            if (!currentToken) { 
                alert('Please login to clear cache'); 
                return; 
            } 
 
            if (!confirm('Are you sure you want to clear Redis cache?')) { 
                return; 
            } 
 
            try { 
                const response = await fetch(API_URL + '/cache/clear', { 
                    method: 'POST', 
                    headers: { 
                        'Authorization': 'Bearer ' + currentToken 
                    } 
                }); 
 
                const data = await response.json(); 
                alert(data.message); 
                getPosts(); // Refresh to show cache cleared effect 
            } catch (error) { 
                alert('Error clearing cache: ' + error.message); 
            } 
        } 
    </script> 
</body> 
</html> 
